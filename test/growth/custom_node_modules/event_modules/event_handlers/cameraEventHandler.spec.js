const chai = require('chai')
const child_process = require('child_process')
const sinon = require('sinon')

const config_helper = require('../../../../../custom_node_modules/utility_modules/config_helper')
const printouts = require('../../../../../custom_node_modules/utility_modules/printouts')

// Stub config before we require cameraEventHandler because it'll call these on
// load.
sinon.stub(config_helper, 'getConfig').returns({
  camera: {
    image_directory: './test',
    image_width: 1920,
    image_height: 1080,
    image_quality: 100
  }
})
sinon.stub(config_helper, 'getWebData').returns({
  title: 'title'
})

const cameraEventHandler = require('../../../../../custom_node_modules/event_modules/event_handlers/cameraEventHandler')

describe('cameraEventHandler.js tests', function() {
  describe('takeImage() tests', function () {
    it('should call exec() and print on success', async function (){
      sinon.stub(child_process, 'exec').yields(null, null, null)
      let stub_log = sinon.stub(printouts, 'simpleLogPrintout')
      cameraEventHandler.takeImage()
      sinon.assert.calledOnce(stub_log)
    })
    
    it('should call exec() and print an error', async function() {
      sinon.stub(child_process, 'exec').yields('ERROR', null, null)
      let stub_error = sinon.stub(printouts, 'simpleErrorPrintout')
      cameraEventHandler.takeImage()
      sinon.assert.calledOnce(stub_error)
    })
  })
})