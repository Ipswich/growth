const five = require("johnny-five");
const initializeSensors = require('./initializeSensors')
const initializeOutputs = require('./initializeOutputs')
const initializeSchedule = require('./initializeSchedule')
const printouts = require('../utility_modules/printouts')


module.exports.initialize = async function initialize(state) {
  var board;
  return new Promise(async (resolve, reject) => {
    printouts.simpleLogPrintout("Initializing board. . .");
    let board_object = {
      repl: false,
      // debug: false
    }
    board = new five.Board(board_object);
    state.board = board;
    //Find and push DS18B20 Address onto Array
    board.once("ready", async function() { 
      try {  
        printouts.simpleLogPrintout("Initializing sensors. . .");
        await initializeSensors.initializeSensors(state)
        printouts.simpleLogPrintout("Initializing outputs. . .");
        initializeOutputs.initializeOutputs(state)
        printouts.simpleLogPrintout("Initializing schedule. . .")
        await initializeSchedule.initializeSchedule(state)
        printouts.simpleLogPrintout(". . .Done!");
        // If relay control exists, turn on relays
        if(state.relay_control){
          state.relay_control.high()
        }   
      } catch (e) {
        reject(e)
      } finally {
        resolve()
      }
    })
  });
}