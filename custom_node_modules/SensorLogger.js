var mysql = require('mysql');
var config = require('../config/config.json');
var moment = require('moment');
var mappings = require('./Mappings.js')

if(process.env.NODE_ENV == 'development'){
  config = config.development;
} else {
  config = config.production;
}
//Adds a sensor reading to the DB
module.exports.addSensorReading = async function addSensorReading(sensorID, val) {
  await addReading(sensorID, val);
}

//Gets last conditions
function addReading(sensorID, val) {
  return new Promise(resolve => {
    var con = mysql.createConnection(config.database);
    con.connect((err) => {
      if(err){
        reject(err);
      } else {
        con.query('CALL addSensorReading(' + sensorID + ', ' + val + ')', (error, results, fields) => {
          //Error on problem.
          if(error) {
            console.error("SensorLogger.js: addSensorReading() failed, database error.");
            con.destroy();
            reject(error);
          } else {
            //DO STUFF WITH DATA
            con.destroy();
            resolve(results[0])
          }
        })
      }
    });
  })
}
