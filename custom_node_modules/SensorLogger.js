var config = require('../config/config.json');
var mysql = require('mysql');
const utils = require('./Utils')

if(process.env.NODE_ENV == 'development'){
  config = config.development;
} else {
  config = config.production;
}

module.exports.addSensorReadings = async function addSensorReadings(state){
  var con = await mysql.createConnection(config.database);    
  for(i = 1; i <= state.sensorState.getSensorState().length; i++) {
    let data = await utils.getSensorVal(state, i)
    addSensorReadingQuery(data.sensorID, data.val, con)     
  }
  //Close connection
  con.end()
}

async function addSensorReadingQuery(ID, value, con){
  let query = 'CALL addSensorReading(' + ID + ', ' + value + ')'
  await con.query(query, (error, results, fields) => {
    //Error on problem.
    if(error) {
      console.error("SensorLogger.js: addSensorReading() failed, database error.");      
      throw error
    } else {
      //DO STUFF WITH DATA (IT'S ACTUALLY BEEN DONE)
    }
  })
}
