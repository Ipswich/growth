var mysql = require('mysql');
var config = require('../config/config.json');


if(process.env.NODE_ENV == 'development'){
  config = config.development;
} else {
  config = config.production;
}

//Updates sensor address in Database
module.exports.updateSensorAddress = async function(address, sensorID){
  return new Promise(resolve => {
    var con = mysql.createConnection(config.database);
    con.connect((err) => {
      if(err){
        reject(err);
      } else {
        let query = 'CALL updateSensorAddress(' + address + ', ' + sensorID + ')'
        con.query(query, (error, results, fields) => {
          //Error on problem.
          if(error) {
            console.error("updateSensorAddress() failed, database error.");
            con.destroy();
            reject(error);
          } else {
            //(success)
            con.destroy();
          }
        })
      }
    });
  })
}

module.exports.getEnabledSchedules = async function(){
  return new Promise((resolve, reject) => {
    var con = mysql.createConnection(config.database);
    con.connect((err) => {
      if(err){
        reject(err);
      } else {
        let query = 'CALL getEnabledSchedules()'
        con.query(query, (error, results, fields) => {
          //Error on problem.
          if(error) {
            console.error("getEnabledSchedules() failed, database error.");
            con.destroy();
            reject(error);
          } else {
            //(success)
            resolve(results[0])
            con.destroy();
          }
        })
      }
    });
  })
}