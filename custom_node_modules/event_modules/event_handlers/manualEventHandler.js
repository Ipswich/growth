const dbcalls = require('../../utility_modules/database_calls.js')
const eventTriggers = require('../EventTriggers.js')
const utils = require('../../utility_modules/Utils.js')
const printouts = require('../../utility_modules/printouts')

/**
 * Runs manual schedules based on the passed state. Schedules are run instantly.
 * @param {object} state The current state of the system.
 */
module.exports.manualEventHandler = async function ManualEventHandler(state) {
  const events = await dbcalls.getEnabledEvents();
  let schedule = await eventTriggers.getSchedule('Manual');
  schedule = utils.eventTypeMapper(events, schedule)
  //Error on things
  if (events == undefined || schedule == undefined) {
    printouts.simpleErrorPrintout("manualEventHandler.js: manualEventHandler() failed!");
    throw new Error("manualEventHandler.js: manualEventHandler() failed!")
  } else {
    //Iterate through manual Schedules
    for(let i = 0; i < schedule.length; i++){
      await eventTriggers.triggerEvent(schedule[i], state);
    }        
  }
}
